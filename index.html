<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒã‚±ã‚¹ãƒªå‚™è“„ï¼†ä½™å‰°ãƒã‚§ãƒƒã‚«ãƒ¼</title>
    <style>
        :root {
            --primary: #4A90E2;
            --bg: #F0F4F8;
            --card-bg: #FFFFFF;
            --text: #333;
            --accent: #FF6B6B;
            --green: #4CAF50;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            padding-bottom: 100px; /* Footer space */
        }
        h1 { font-size: 1.5rem; text-align: center; color: var(--primary); margin-bottom: 20px; }
        h2 { font-size: 1.2rem; border-left: 5px solid var(--primary); padding-left: 10px; margin-top: 30px;}
        
        /* Layout */
        .container { max-width: 800px; margin: 0 auto; }
        
        /* Filter Buttons */
        .filters { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .filter-btn {
            padding: 8px 16px; border: none; border-radius: 20px; background: #ddd; cursor: pointer; font-weight: bold;
        }
        .filter-btn.active { background: var(--primary); color: white; }

        /* Recipe Grid */
        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
        }
        .recipe-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            text-align: center;
            cursor: pointer;
            transition: transform 0.1s;
            user-select: none;
            border: 2px solid transparent;
            position: relative;
        }
        .recipe-card:active { transform: scale(0.98); }
        .recipe-card.selected { border-color: var(--primary); background-color: #eef6ff; }
        
        .recipe-name { font-size: 0.9rem; font-weight: bold; margin-bottom: 10px; height: 2.4em; display: flex; align-items: center; justify-content: center;}
        .count-badge {
            background: var(--primary); color: white;
            border-radius: 50%; width: 30px; height: 30px;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; margin: 0 auto;
        }
        .hidden { display: none; }

        /* Controls inside card */
        .card-controls { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
        .sub-btn { background: #ccc; border: none; width: 24px; height: 24px; border-radius: 50%; font-weight: bold; cursor: pointer; }

        /* Dashboard (Sticky Bottom) */
        .dashboard {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid #ddd;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
            z-index: 100;
        }
        .dash-content { max-width: 800px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;}
        .reset-btn { background: var(--accent); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; }
        
        /* Result Lists */
        .result-section { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;}
        @media (max-width: 600px) { .result-section { grid-template-columns: 1fr; } }
        
        .ingredient-list { list-style: none; padding: 0; }
        .ingredient-item {
            display: flex; justify-content: space-between;
            background: white; padding: 8px 12px; margin-bottom: 5px; border-radius: 6px;
        }
        .surplus-tag { background: #e0f2f1; color: #00695c; }
        .needed-tag { background: #ffebee; color: #c62828; }

    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¥˜ ãƒã‚±ã‚¹ãƒªå‚™è“„ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼</h1>

    <div class="filters">
        <button class="filter-btn active" onclick="filterRecipes('all')">ã™ã¹ã¦</button>
        <button class="filter-btn" onclick="filterRecipes('ã‚«ãƒ¬ãƒ¼')">ã‚«ãƒ¬ãƒ¼</button>
        <button class="filter-btn" onclick="filterRecipes('ã‚µãƒ©ãƒ€')">ã‚µãƒ©ãƒ€</button>
        <button class="filter-btn" onclick="filterRecipes('ãƒ‡ã‚¶ãƒ¼ãƒˆ')">ãƒ‡ã‚¶ãƒ¼ãƒˆ</button>
    </div>

    <div id="recipe-list" class="recipe-grid">
        </div>

    <div class="result-section">
        <div>
            <h2>ğŸ“¦ å¿…è¦ãªé£Ÿæ (åˆè¨ˆ)</h2>
            <ul id="needed-list" class="ingredient-list"></ul>
        </div>
        <div>
            <h2>âœ¨ ä½™å‰°é£Ÿæ (ä¸ä½¿ç”¨)</h2>
            <p style="font-size:0.8rem; color:#666;">ã“ã‚Œã‚‰ã¯ä»Šå›ã®æ–™ç†ã«ä½¿ã‚ã‚Œã¾ã›ã‚“ã€‚<br>é‹ã®éš™é–“ã«å…¥ã‚Œã¦OKï¼</p>
            <ul id="surplus-list" class="ingredient-list"></ul>
        </div>
    </div>
</div>

<div class="dashboard">
    <div class="dash-content">
        <div>
            <span style="font-weight:bold;">é¸æŠæ–™ç†æ•°: <span id="total-meals">0</span>é£Ÿ</span>
        </div>
        <button class="reset-btn" onclick="resetAll()">ã‚ªãƒ¼ãƒ«ã‚¯ãƒªã‚¢ ğŸ—‘ï¸</button>
    </div>
</div>

<script>
    // === ãƒ‡ãƒ¼ã‚¿å®šç¾© (ä¸»è¦ãªãƒ¬ã‚·ãƒ”ã®ã¿æŠœç²‹ã—ã¦ã„ã¾ã™ã€‚å¿…è¦ã«å¿œã˜ã¦è¿½åŠ ã—ã¦ãã ã•ã„) ===
    const ALL_INGREDIENTS = [
        "ç‰¹é¸ãƒªãƒ³ã‚´", "ã‚ã¾ã„ãƒŸãƒ„", "ãƒãƒ¡ãƒŸãƒ¼ãƒˆ", "ã‚ã‚“ã¿ã‚“ãƒˆãƒãƒˆ", "ã»ã£ã“ã‚Šãƒãƒ†ãƒˆ", 
        "ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚«ã‚«ã‚ª", "ãŠã„ã—ã„ã‚·ãƒƒãƒ", "ãƒ¢ãƒ¼ãƒ¢ãƒ¼ãƒŸãƒ«ã‚¯", "ã¨ãã›ã‚“ã‚¨ãƒƒã‚°", 
        "ãƒ¯ã‚«ã‚¯ã‚µã‚³ãƒ¼ãƒ³", "æ¿€è¾›ãƒãƒ¼ãƒ–", "ãƒ”ãƒ¥ã‚¢ãªã‚ªã‚¤ãƒ«", "ã‚ã£ãŸã‹ã‚¸ãƒ³ã‚¸ãƒ£ãƒ¼", 
        "ã˜ã‚ã£ã¨ã‚­ãƒã‚³", "ãµã¨ã„ãƒŠã‚¬ãƒã‚®", "ã‚ã–ã¾ã—ã‚³ãƒ¼ãƒ’ãƒ¼"
    ];

    const RECIPES = [
        // ã‚«ãƒ¬ãƒ¼
        { id: "c1", name: "ãœã£ãŸã„ã­ã‚€ã‚Šãƒã‚¿ãƒ¼ã‚«ãƒ¬ãƒ¼", type: "ã‚«ãƒ¬ãƒ¼", ingredients: { "ã»ã£ã“ã‚Šãƒãƒ†ãƒˆ": 18, "ã˜ã‚ã£ã¨ã‚­ãƒã‚³": 12, "ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚«ã‚«ã‚ª": 15, "ãƒ¢ãƒ¼ãƒ¢ãƒ¼ãƒŸãƒ«ã‚¯": 10 } },
        { id: "c2", name: "ç…‰ç„ã‚³ãƒ¼ãƒ³ã‚­ãƒ¼ãƒã‚«ãƒ¬ãƒ¼", type: "ã‚«ãƒ¬ãƒ¼", ingredients: { "æ¿€è¾›ãƒãƒ¼ãƒ–": 27, "ãƒãƒ¡ãƒŸãƒ¼ãƒˆ": 24, "ãƒ¯ã‚«ã‚¯ã‚µã‚³ãƒ¼ãƒ³": 14, "ã‚ã£ãŸã‹ã‚¸ãƒ³ã‚¸ãƒ£ãƒ¼": 12 } },
        { id: "c3", name: "ãƒ‹ãƒ³ã‚¸ãƒ£ã‚«ãƒ¬ãƒ¼", type: "ã‚«ãƒ¬ãƒ¼", ingredients: { "ãƒ¯ã‚«ã‚¯ã‚µå¤§è±†": 15, "ãƒãƒ¡ãƒŸãƒ¼ãƒˆ": 9, "ãµã¨ã„ãƒŠã‚¬ãƒã‚®": 9, "ã˜ã‚ã£ã¨ã‚­ãƒã‚³": 5 } }, // æ³¨: å¤§è±†ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ALL_INGREDIENTSã«ã‚‚å¿…è¦
        { id: "c4", name: "ãƒã‚¤ãƒ«ãƒ‰ãƒãƒ‹ãƒ¼ã‚«ãƒ¬ãƒ¼", type: "ã‚«ãƒ¬ãƒ¼", ingredients: { "ã‚ã¾ã„ãƒŸãƒ„": 7 } },
        // ã‚µãƒ©ãƒ€
        { id: "s1", name: "ãƒ‹ãƒ³ã‚¸ãƒ£ã‚µãƒ©ãƒ€", type: "ã‚µãƒ©ãƒ€", ingredients: { "ãµã¨ã„ãƒŠã‚¬ãƒã‚®": 15, "ãƒ¯ã‚«ã‚¯ã‚µå¤§è±†": 15, "ã˜ã‚ã£ã¨ã‚­ãƒã‚³": 12, "ã‚ã£ãŸã‹ã‚¸ãƒ³ã‚¸ãƒ£ãƒ¼": 11 } },
        { id: "s2", name: "ãƒ¯ã‚«ã‚¯ã‚µã‚µãƒ©ãƒ€", type: "ã‚µãƒ©ãƒ€", ingredients: { "ãƒ”ãƒ¥ã‚¢ãªã‚ªã‚¤ãƒ«": 22, "ãƒ¯ã‚«ã‚¯ã‚µã‚³ãƒ¼ãƒ³": 17, "ã‚ã‚“ã¿ã‚“ãƒˆãƒãƒˆ": 14, "ã»ã£ã“ã‚Šãƒãƒ†ãƒˆ": 9 } },
        { id: "s3", name: "ã‚ã„ãã†ã‚¹ã‚¤ãƒ¼ãƒˆã‚µãƒ©ãƒ€", type: "ã‚µãƒ©ãƒ€", ingredients: { "ã‚ã¾ã„ãƒŸãƒ„": 21, "ç‰¹é¸ãƒªãƒ³ã‚´": 15, "ãƒ¯ã‚«ã‚¯ã‚µã‚³ãƒ¼ãƒ³": 12 } },
        // ãƒ‡ã‚¶ãƒ¼ãƒˆ
        { id: "d1", name: "ãŠã¡ã‚ƒã‹ã„ã‚³ãƒ¼ãƒ³ã‚¹ã‚³ãƒ¼ãƒ³", type: "ãƒ‡ã‚¶ãƒ¼ãƒˆ", ingredients: { "ç‰¹é¸ãƒªãƒ³ã‚´": 20, "ã‚ã£ãŸã‹ã‚¸ãƒ³ã‚¸ãƒ£ãƒ¼": 20, "ãƒ¯ã‚«ã‚¯ã‚µã‚³ãƒ¼ãƒ³": 18, "ãƒ¢ãƒ¼ãƒ¢ãƒ¼ãƒŸãƒ«ã‚¯": 9 } },
        { id: "d2", name: "ãƒ—ãƒªãƒ³ã®ãƒ—ãƒªãƒ³ã‚¢ãƒ©ãƒ¢ãƒ¼ãƒ‰", type: "ãƒ‡ã‚¶ãƒ¼ãƒˆ", ingredients: { "ã‚ã¾ã„ãƒŸãƒ„": 20, "ã¨ãã›ã‚“ã‚¨ãƒƒã‚°": 15, "ãƒ¢ãƒ¼ãƒ¢ãƒ¼ãƒŸãƒ«ã‚¯": 10, "ç‰¹é¸ãƒªãƒ³ã‚´": 10 } },
        { id: "d3", name: "ãƒ•ãƒ©ãƒ¯ãƒ¼ã‚®ãƒ•ãƒˆãƒã‚«ãƒ­ãƒ³", type: "ãƒ‡ã‚¶ãƒ¼ãƒˆ", ingredients: { "ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚«ã‚«ã‚ª": 25, "ã¨ãã›ã‚“ã‚¨ãƒƒã‚°": 25, "ã‚ã¾ã„ãƒŸãƒ„": 17, "ãƒ¢ãƒ¼ãƒ¢ãƒ¼ãƒŸãƒ«ã‚¯": 10 } }
    ];

    // æ³¨: "ãƒ¯ã‚«ã‚¯ã‚µå¤§è±†" ãŒALL_INGREDIENTSã‹ã‚‰æŠœã‘ã¦ã„ãŸã®ã§è£œå®Œ
    if(!ALL_INGREDIENTS.includes("ãƒ¯ã‚«ã‚¯ã‚µå¤§è±†")) ALL_INGREDIENTS.push("ãƒ¯ã‚«ã‚¯ã‚µå¤§è±†");
    ALL_INGREDIENTS.sort();

    // === ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹ ===
    let state = {}; // { recipeId: count }

    // === åˆæœŸåŒ– ===
    function init() {
        const saved = localStorage.getItem('pokeSleepPlanner');
        if (saved) {
            state = JSON.parse(saved);
        } else {
            // åˆæœŸçŠ¶æ…‹
            RECIPES.forEach(r => state[r.id] = 0);
        }
        renderRecipes();
        updateCalculation();
    }

    // === ãƒ¬ã‚·ãƒ”æç”» ===
    function renderRecipes() {
        const container = document.getElementById('recipe-list');
        container.innerHTML = '';

        RECIPES.forEach(recipe => {
            const count = state[recipe.id] || 0;
            const div = document.createElement('div');
            div.className = `recipe-card ${count > 0 ? 'selected' : ''}`;
            div.dataset.type = recipe.type;
            div.onclick = (e) => {
                if(e.target.tagName === 'BUTTON') return; // ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã¯è¦ªã®ã‚¯ãƒªãƒƒã‚¯ã‚’ç„¡è¦–
                increment(recipe.id);
            };

            div.innerHTML = `
                <div class="recipe-name">${recipe.name}</div>
                <div class="count-badge">${count}</div>
                <div class="card-controls ${count > 0 ? '' : 'hidden'}">
                    <button class="sub-btn" onclick="decrement('${recipe.id}')">-</button>
                </div>
            `;
            container.appendChild(div);
        });
    }

    // === ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ ===
    function filterRecipes(type) {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');

        const cards = document.querySelectorAll('.recipe-card');
        cards.forEach(card => {
            if (type === 'all' || card.dataset.type === type) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    // === ã‚«ã‚¦ãƒ³ãƒˆæ“ä½œ ===
    function increment(id) {
        state[id] = (state[id] || 0) + 1;
        saveAndRender();
    }

    function decrement(id) {
        if (state[id] > 0) state[id]--;
        saveAndRender();
    }

    function resetAll() {
        if(!confirm("é¸æŠå†…å®¹ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ")) return;
        Object.keys(state).forEach(k => state[k] = 0);
        saveAndRender();
    }

    function saveAndRender() {
        localStorage.setItem('pokeSleepPlanner', JSON.stringify(state));
        renderRecipes();
        updateCalculation();
    }

    // === è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ ===
    function updateCalculation() {
        const totalIngredients = {};
        let totalMeals = 0;
        
        // 1. å¿…è¦ãªé£Ÿæã‚’é›†è¨ˆ
        Object.keys(state).forEach(id => {
            const count = state[id];
            if (count > 0) {
                totalMeals += count;
                const recipe = RECIPES.find(r => r.id === id);
                Object.entries(recipe.ingredients).forEach(([ing, num]) => {
                    totalIngredients[ing] = (totalIngredients[ing] || 0) + (num * count);
                });
            }
        });

        // 2. è¡¨ç¤ºæ›´æ–°ï¼šå¿…è¦é£Ÿæ
        const neededList = document.getElementById('needed-list');
        neededList.innerHTML = '';
        const neededKeys = Object.keys(totalIngredients).sort();
        
        if (neededKeys.length === 0) {
            neededList.innerHTML = '<li style="color:#999; text-align:center;">æ–™ç†ã‚’é¸æŠã—ã¦ãã ã•ã„</li>';
        } else {
            neededKeys.forEach(ing => {
                const li = document.createElement('li');
                li.className = 'ingredient-item needed-tag';
                li.innerHTML = `<span>${ing}</span> <strong>${totalIngredients[ing]}å€‹</strong>`;
                neededList.appendChild(li);
            });
        }

        // 3. è¡¨ç¤ºæ›´æ–°ï¼šä½™å‰°é£Ÿæ (å…¨é£Ÿæãƒªã‚¹ãƒˆ - å¿…è¦é£Ÿæãƒªã‚¹ãƒˆ)
        const surplusList = document.getElementById('surplus-list');
        surplusList.innerHTML = '';
        
        const surplus = ALL_INGREDIENTS.filter(ing => !totalIngredients[ing]);
        
        surplus.forEach(ing => {
            const li = document.createElement('li');
            li.className = 'ingredient-item surplus-tag';
            li.innerHTML = `<span>${ing}</span> <span>Free</span>`;
            surplusList.appendChild(li);
        });

        document.getElementById('total-meals').textContent = totalMeals;
    }

    // åˆæœŸå®Ÿè¡Œ
    init();
</script>

</body>
</html>
